{% load static %}

<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Rule Configurer</title>
    <!-- use bootstrap UI -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/sharedsteps.css' %}" />
    
    <script src="{% static 'js/jquery-3.7.1.js'%}"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://kit.fontawesome.com/95a71e9646.js" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.1/Sortable.min.js" integrity="sha512-3N7dD+tlndNxwAC0PwGNWnnEpzHQwgNl6/c9XW6+nqptoMhbI9Rb6kQiUFtYmXrox60oIELVSFAO0dCSfKb2tw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-sortablejs@latest/jquery-sortable.js"></script>
    
</head>

<body class="container-none h-screen w-screen px-8">

    <!-- 
        The <noscript> tag encloses the content that will be displayed 
        only if JavaScript is disabled or not supported in the user's browser. 
    -->
    <noscript>
        If you see this text, your browser does not support dynamic content
        (JavaScript) or it has been disabled. This study website requires JavaScript.
    </noscript>
    {% csrf_token %}

    <div x-data="{}" class="flex flex-col justify-start gap-y-4 py-3 items-stretch h-full">
        <div class="pb-1 mx-4 flex-grow-0 self-start text-base text-black">
            <span class="font-bold">Task Description</span>: You are reviewing a news site comments and you are expected to write a set of rules that can be used to automatically approve or remove comments. Rules that come earlier in the list have higher priority. ... 
            {% if stage == "update" %}
                You have already built and tested your classifier. Now please update your classifier by reviewing the performance of your classifier on your labeled examples. You can also spend more time reviewing more training examples.
            {% endif %}
        </div>

        <div x-data="{stage: '{{ stage }}'}" class="flex items-stretch w-full gap-x-4 flex-grow">
            <!-- the section where users configure prompts -->
            <div class="flex flex-col items-stretch gap-y-4 pt-2 px-4 border border-gray-600 rounded w-1/2 flex-grow">
                
                <!-- the section where users see all rules -->
                <div class="section-body flex flex-col flex-grow gap-y-4 pb-4">
                    <div id="ruleList" class="flex flex-col gap-y-2 flex-grow h-1 overflow-y-auto">
                        <div @click="addNewRule" class="addButton flex justify-center items-center gap-x-4 border border-gray-300 rounded-lg h-10 cursor-pointer">
                            <div class="text-3xl text-gray-500">+</div>
                        </div>
                    </div>
                    <div class="bottom flex justify-end gap-x-2 flex-grow-0">
                        <button x-on:click="trainTrees(dataset);" class="bg-teal-400 text-white font-bold py-2 px-3 rounded">
                            Filter Examples
                        </button>
                        <button x-on:click="complete();" class="bg-blue-600  text-white font-bold py-2 px-3 rounded">
                            Complete
                        </button>
                    </div>
                </div>
            </div>
            <!-- the section where users see example examples and predictions -->
            <div class="flex flex-col w-1/2 h-full">
                <!-- display a set of filter options -->
                
                <div class="flex flex-col gap-y-1 h-full border border-gray-600 rounded px-3 pt-2 pb-4 ">
                    <div class="header text-lg font-bold">
                        What comments are targeted by your rules?
                    </div>
                    <div class="flex flex-col items-start gap-y-1">
                        <div class="flex justify-start items-center gap-x-2 w-[60%]">
                            <div>Filters</div>
                            <div class="w-[50%]">
                                <select id="predictionFilter" class="selectpicker  data-filter border rounded show-tick" title="by predictions" data-width="100%" >
                                    <option value="targeted" class=" text-xs text-gray-700">Targeted comments</option>
                                    <option value="not-targeted" selected class=" text-xs text-gray-700">Not Targeted comments</option>
                                    <option value="all" selected class=" text-xs text-gray-700">All comments</option>
                                </select>
                            </div>
                            <div class="w-[45%]">
                                <select id="ruleFilter"
                                    class="selectpicker data-filter show-tick border rounded" 
                                    title="by rules" 
                                    data-width="100%"
                                    data-selected-text-format="count"
                                    data-count-selected-text="{0} rules selected"
                                >
                                    
                                </select>
                            </div>
                        </div>
                        <div id="countDisplay" class="text-sm text-gray-700 self-start"></div>
                    </div>
                    <!-- display a list of comments to be reviewed -->
                    <div id="textList" class="body flex flex-col overflow-y-auto py-2 h-1 pr-2 flex-grow"></div>
                    <div class="bottom flex justify-end gap-x-2 pt-3">
                        <button @click="load_more_data" class="bg-slate-400 text-white font-bold py-2 px-3 rounded">
                            Load More Examples
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="loadingModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
            <div class="relative top-1/3 mx-auto p-5 border w-fit shadow-lg rounded-md bg-white">
                <div id="loadingModalText" class="text-center text-xl">
                    Loading...
                </div>
            </div>
        </div>

    </div>
</body> <!-- closes container -->
<!-- custom js -->
<script src="{% static 'js/sharedsteps.js' %}" defer></script>
<script defer>
    const SYSTEM = "{{system}}";
    const participant_id = "{{participant_id}}";
    const stage = "{{stage}}";

    var dataset = [];

    // we assume every single quote is properly escaped; this should be ensured when adding them to the list
    // for now, we only require users to input one example for each category
    var rules = {};
    var rule_counter = 0; // indicate the higher id that has been used

    var selected_rules = [];
    var selected_prediction = "all";

    /* 
        functions that display, add, and remove rules
    */
    function updatePriority(){
        
        $('#ruleList .ruleSection').each(function(index) {
            // get the id of the ruleSection
            let id = +$(this).attr('id').split('-')[1];
            rules[id].priority = index;

            // update the priority class div of the this ruleSection
            $(this).find('.priority').text(`${index + 1}.`);
        });
        // console.log(rules);
    }

    function updateOptions(id, text){
        // update the options of the select picker
        rules[id].name = text;
        $(`#ruleFilter option[value=${id}]`).text(capitalize(text));
        $(".selectpicker").selectpicker('refresh');
    }

    function get_unit_section(type, words){
        return `
            <div class='unitSection flex gap-x-4 items-center'>
                <div class='unitType ${type} w-fit relative text-center text-lg font-medium rounded bg-zinc-100 py-1 px-3 shadow-sm'>
                    <span class="inline-block whitespace-nowrap">
                        ${type === "include" ? '<i class="fa-solid fa-plus fa-sm text-green-600 mr-2"></i>Include' : '<i class="fa-solid fa-ban fa-sm text-orange-600 mr-2"></i>Exclude'}
                    </span>
                    <button class='absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-white rounded-full text-xs w-4 h-4 flex items-center justify-center border border-gray-300'
                        x-on:click="remove_unit_section($event, 'unitSection')"
                    >
                        &times;
                    </button>
                </div>
                <div class='grow flex wordSection'>
                    <input 
                        class='grow wordList border-b-2 border-l-0 border-r-0 border-t-0'
                        value='${words.join(",")}' 
                        autofocus
                    >
                </div>
            </div>`;
    }
    
    function addNewUnit(element, type){
        let unit_sections = $(element).closest('.ruleSection').find('.unitSections');
        let unit_section_html = get_unit_section(type, []);
        unit_sections.append(unit_section_html);
        // tagify the newly added unit section
        let tag = new Tagify(unit_sections.children().last().find('.wordList')[0]);
    }

    function displayRules(new_rules){
        // display the rules in the ruleList
        let ruleList = $('#ruleList');

        new_rules.forEach((rule) => {
            rule.id = rule_counter++;
            // the priority is the existing number of ruleSection items in the ruleList div
            rule.priority = ruleList.children().length - 1;
            let unit_section_html = "";
            /*
                rule-section: where users select the corresponding action
                    unit-sections: where users configure include or exclude units
                        word-section: where users configure the word and its variants
            */
            rule.units.forEach((unit) => {            
                unit_section_html  += get_unit_section(unit.type, unit.words);
            });

            let rule_div_html = `
                <div 
                    x-data="{open: false, action: ${rule.action}}" 
                    class="ruleSection flex flex-col items-stretch border border-gray-300 rounded-lg px-3" 
                    id="rule-${rule.id}"
                >
                    <div class="flex justify-between py-2">
                        <div class="grow text-black flex items-center font-serif gap-x-2">
                            <div class="priority text-2xl">
                                ${rule.priority + 1}.
                            </div>
                            <!-- Toggle Switch for Rule Action -->
                            <div class="grow flex items-center font-medium text-xl ">
                                <button 
                                    class="removeButton grow py-2 px-4 rounded italic" 
                                    :class="{ 'active bg-red-100': action === 1, 'bg-gray-100 text-gray-300': action !== 1}" 
                                    x-on:click="action = 1"
                                >
                                    Remove
                                </button>
                                <button 
                                    class="approveButton grow py-2 px-4 rounded italic " 
                                    :class="{ 'active bg-blue-100': action === 0, 'bg-gray-100 text-gray-300': action !== 0 }" 
                                    x-on:click="action = 0"
                                >
                                        Approve
                                </button>
                            </div>
                            <div x-data="{charLimit: 30, inputExceedsLimit: false,  text: '${rule.name}' }" class="w-[40%] .editableSectionTitle">
                                <div 
                                    contenteditable="true" 
                                    x-text="text"
                                    x-on:input="text = $event.target.innerText; inputExceedsLimit = (text.length > charLimit); if(inputExceedsLimit) text = text.substr(0, charLimit); updateOptions(${rule.id}, text);"
                                    class="italic font-xl border border-gray-300 p-2 rounded"
                                    :class="{'border-red-500': inputExceedsLimit}"
                                    data-placeholder="What Texts?"
                                ></div>
                                <div x-show="inputExceedsLimit" 
                                    class="text-red-600 text-sm mt-1" 
                                    x-text="'The title should be less than ' + charLimit + ' characters.'"
                                ></div>
                            </div>
                        </div>
                        <!--have a foldable button-->
                        <div class="flex justify-center gap-x-2 ml-4">
                            <button @click="deleteRule(${rule.id})" class="focus:outline-none">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                            <button @click="open = !open" class="focus:outline-none">
                                <svg x-show="!open" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                                <svg x-show="open" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="unitSections flex flex-col gap-y-4 py-2" x-show="open">
                        ${unit_section_html}
                    </div>
                    <div class="self-stretch flex justify-between gap-x-2 py-2 items-center" x-show="open">
                        <div class="">
                            <button class="addInclude p-1 text-sm rounded border border-zinc-50" x-on:click="addNewUnit($el, 'include')">
                                <i class="fa-solid fa-plus text-green-600 mr-2"></i>Add Include
                            </button>
                            <button class="addExclude p-1 text-sm rounded border border-zinc-50" x-on:click="addNewUnit($el, 'exclude')">
                                <i class="fa-solid fa-ban text-orange-600 mr-2"></i>Add Exclude
                            </button>
                        </div>
                        <div class="flex p-1 gap-x-1 items-center">
                            <input type="checkbox" class="variantsCheckbox h-4 w-4" ${rule.variants ? "checked" : ""}/>
                            <label class="text-base text-gray-600">Include spelling variants</label>
                            
                            <div x-data="{ open: false}">
                                <!-- Tooltip Trigger -->
                                <button 
                                    @click="open = !open" 
                                    class="p-1 rounded-full text-gray-700 hover:bg-gray-100"
                                >
                                    <i class="fas fa-circle-question"></i>
                                </button>

                                <!-- Tooltip Content -->
                                <div x-show="open" @click.away="open = false" 
                                    class="fixed z-50 w-fit p-2 text-sm text-white bg-gray-600 rounded-md shadow-lg" 
                                    
                                >
                                    We only use the most common ways of spelling variants:
                                    <ul class="list-disc list-inside">
                                        <li>repeating letters (cool -> coool)</li>
                                        <li>mixed upper and lower case (cool -> cOoL)</li>
                                        <li>using similar looking characters (cool -> c00l)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            `;
        
            $('#ruleList > :last-child').before(rule_div_html);
            rules[rule.id] = rule;

            // add an option to the select picker for this prompt, rules are not selected by default
            $('#ruleFilter').append(`<option value=${rule.id} class="text-xs">${rule.name.length === 0 ? "Unnamed Rule" : rule.name}</option>`);
            $(".selectpicker").selectpicker('refresh');
            
            // selected_rules.push(rule.id);

            $(`#rule-${rule.id} input.wordList`).each(function() {
                // Initialize Tagify on each input element
                let tag = new Tagify($(this)[0]);
            });
        });
    }

    function deleteRule(deleted_id) {
        console.log(`deleting rule ${deleted_id}`);
        delete rules[deleted_id];
        $(`#rule-${deleted_id}`).remove();

        // remove the option from the select picker
        $(`#ruleFilter option[value=${deleted_id}]`).remove();
        $(".selectpicker").selectpicker('refresh');

        // remove the rule from selected_prompts if needed
        selected_rules = selected_rules.filter((id) => id != deleted_id);

        updatePriority();
    }

    function addNewRule(){
        // read from configuring rule panel and add this new rule to the rules in jquery
        let new_rule = {
                "action": 1,
                "name": [],
                "units": []   
            };
        displayRules([new_rule]);
    }

    /* 
        functions that handle the display of the data 
    */
    function load_more_data() {
        get_backend(
            "/load_more_data/", 
            {'participant_id': participant_id},
            function(data){
                data = JSON.parse(data);
                dataset = display_data(data, dataset);
            }
        );
    }

    function showFilteredData(){
        /* iterature through dataset and hide the datum that doesn't match the filter selected_prediction and selected_prompts */

        let expected_prediction = selected_prediction === "targeted" ? [1, 0] : selected_prediction === "not-targeted" ? [null] : [1, 0, null];
        let counter = 0;
        let targeted_counter = 0;
        let approved_counter = 0;
        let removed_counter = 0;

        console.log("selected rules", selected_rules);
        console.log("selected_predictions", selected_prediction)
        dataset.forEach((datum, index) => {
            let show = true;
            let now_prediction = null;
            if(expected_prediction.length < 3){
                // otherwise, regardless of what rules are selected, we all show all comments as the expectd prediction is the all
                if (selected_rules.length > 0){
                    // only show comments that are targeted (not targeted) by all the selected rules
                    show = selected_rules.every(rule_id => {
                        let found_pred = datum.predictions.find(rule => rule.id === rule_id);
                        return found_pred !== undefined && expected_prediction.includes(found_pred.prediction);
                    })
                } else {
                    // show all comments that are targeted (not targeted) by any of the rules
                    show = expected_prediction.includes(datum.total_prediction);
                }
            }

            
            if (show){
                $(`#datum-${index}`).parent().show();
                counter++;
                targeted_counter += datum.total_prediction !== null ? 1 : 0;
                approved_counter += datum.total_prediction === 0 ? 1 : 0;
                removed_counter += datum.total_prediction === 1 ? 1 : 0;
            } else{
                $(`#datum-${index}`).parent().hide();
            }
        });

        let text = ""
        if(expected_prediction.length === 3) 
            text = `There are ${targeted_counter}/${counter} targeted comments in total; among them, ${approved_counter} approved and ${removed_counter} removed`;
        else if(selected_rules.length === 0 && selected_prediction === "targeted"){
            text = `There are ${counter} ${selected_prediction} comments in total; among them, ${approved_counter} approved and ${removed_counter} removed`;
        } else if(selected_rules.length === 0 && selected_prediction === "not-targeted"){
            text = `There are ${counter} ${selected_prediction} comments, so they are approvedy by default`;
        } else {
            text = `
                There are ${counter} comments that are ${selected_prediction} by all selected rules, ${approved_counter} approved and ${removed_counter} removed`;
        }

        $('#countDisplay').text(text);

    }

    $("#predictionFilter").on("change", function() {
        selected_prediction = $(this).val();
        showFilteredData();
        
    });

    $("#ruleFilter").on("change", function() {
        selected_rules = [$(this).val()].map((value) => +value )
        showFilteredData();
    });

    function generateExplanation(datum){
        /* generate the explanation for each prediction made by the LLMs */
        if (datum.total_prediction === null){
            return "This comment is not targeted by any of your rules, so it will be approved by default.";
        }
        else {
            let explanation = `<p>This comment is targeted by the following rule :</p><ul class='list-none pl-0 text-gray-600'>`;
            // iterate through the dict object and format each prompt in a new line and with italic font
            let highest_priority = Infinity;
            let highest_priority_id = null;
            for (let i = 0; i < datum.predictions.length; i++) {
                const pred = datum.predictions[i];
                if (pred.prediction !== null){
                    let rule = rules[pred.id];
                    
                    explanation += `
                        <li class="before:content-['•'] before:mr-2">
                            Priority ${rule.priority + 1}: Rule <span class="font-medium italic font-serif">${rule.name}</span>
                        </li>`;
                    if (rule.priority < highest_priority){
                        highest_priority = rule.priority;
                        highest_priority_id = pred.id;
                    }
                }
            }
            explanation += "</ul>";

            let highest_priority_rule = rules[highest_priority_id];
            explanation += `<br/><p>
                As the rule <span class="font-bold italic font-serif">${highest_priority_rule.name}</span> has the highest priority ${highest_priority_rule.priority + 1}, 
                this comment should be <span class="font-bold italic">${datum.total_prediction === 1 ? "removed" : "approved"}</span>.`;
            
            return explanation;
        }
    }

    function updateDataLabels(results) {
        /* update the labels of the data according to the predictions given by LLMs */
        let true_counter = 0;
        let prediction = results["prediction"];
        let texts_predictions = results["texts_predictions"];
    
        for (let i = 0; i < prediction.length; i++) {
            dataset[i].total_prediction = prediction[i];
            dataset[i].predictions = texts_predictions[i];
            
            // update the label according to the total prediction
            let new_class = dataset[i].total_prediction === null ? "unLabel" : dataset[i].total_prediction ? "trueLabel" : "falseLabel";
            const datum = $(`#datum-${i}`);
            datum.removeClass("unLabel trueLabel falseLabel");
            datum.addClass(new_class);

            // select the tooltip
            const tooltip_div = $(`#datumTooltip-${i}`);
            tooltip_div.removeClass("unLabel trueLabel falseLabel");
            tooltip_div.addClass(new_class);

            // update the tooltip content
            let explanation = generateExplanation(dataset[i]);
            // set the second child of the tooltip div to be the explanation, use innerhtml

            tooltip_div.children().eq(1).html(explanation);
        }
    }

    /* 
        functions that handle the training of the tree classifier 
    */

    function parseContent() {
        /* we do not listen to the changes of the rules actively but instead parse the content when the user clicks the complete or classify button */
        // for each div element with the id format rules-${rule.rule_id}-${setting_index}, iterate over all children of the class termSection
        // for each termSection get the value of the synonyms via the class synonyms and the value of the checkbox via the class spellingVariants
        // update the corresponding rule's setting_index'th setting's value accordingly

        let now_rules = []
        $('#ruleList .ruleSection').each(function(index) {
            // parse out the id of the ruleSection
            let id = +$(this).attr('id').split('-')[1];
            let rule = rules[id];

            rule.priority = index;
            rule.action = $(this).find('.approveButton').hasClass('active') ? 0 : 1; // we consider removing a text as 1 and approving a text as 0
            rule.variants = $(this).find('.variantsCheckbox').is(':checked');
            let units = [];
            $(this).find('.unitSection').each(function() {
                let unit = {};
                unit.type = $(this).find('.unitType').hasClass('include') ? "include" : "exclude";
                unit.words = [];
                // iterature through the tags element with the class wordList and get the title of each children tag element
                $(this).find('.tagify__tag').each(function() {
                    unit.words.push($(this).attr('title'));
                });

                if (unit.words.length > 0){
                    units.push(unit);
                }
            });
            rule.units = units;
            if(rule.units.length > 0){
                now_rules.push(rule);
            }
        });
        console.log("parsed out rules: ", now_rules);
        return now_rules;
    }

    function trainTrees() {
        let now_rules = parseContent();
        $('#loadingModal').removeClass('hidden');
        $('#loadingModalText').text('Waiting for algorithms');
        post_backend(
            "/trainTrees/", 
            {'dataset': dataset, 'rules': now_rules, 'participant_id': participant_id},
            function(response){
                if(!response["status"]){
                    alert(response["message"]);
                    return;
                }
                
                console.log(response.data.results);
                updateDataLabels(response.data.results);
                showFilteredData();
                
                $('#loadingModal').addClass('hidden');
            }
        );
    }

    function complete(){
        /* store the prompts written by the user */
        let now_rules = parseContent();
        post_backend(
            "/store_rules/", 
            {'rules': now_rules, 'participant_id': participant_id, 'stage': stage},
            function(response){
                if(!response["status"])
                    alert(response["message"]);
                else
                    redirect("/validate_page/", {'participant_id': participant_id, 'system': SYSTEM});
                    
            }
        )

    }

    $(document).ready(function(){
        dataset = display_data(JSON.parse(`{{dataset | safe}}`), dataset, false);
        $("#ruleList").sortable({
            animation: 150,
            filter: ".addButton",
            onEnd: function(event, ui) {
                // console.log("updating priority");
                updatePriority();
            }
        });

        if(stage === "update"){
            displayRules(JSON.parse(`{{rules | safe}}`));
        } else {
            displayRules([
                {
                    "action": 0,
                    "name": "Trump-related discussion",
                    "variants": true,
                    "units": [
                        {
                            "type": "include",
                            "words": ["Trump", "Donald Trump"],
                        }
                    ]
                },
                {
                    "action": 1,
                    "name": "Sexual accusation",
                    "variants": false,
                    "units": [
                        {
                            "type": "include",
                            "words": ["sex offender", "rapists", "fuck"],
                        },
                    ]   
                },
                {
                    "action": 1,
                    "name": "Personal attack",
                    "variants": false,
                    "units": [
                        {
                            "type": "include",
                            "words": ["nonsense", "asshole", "stupid", "idiot", "fool", "stupidity"],
                        },

                    ]
                },
                {
                    "action": 1,
                    "name": "Terrorist accusation",
                    "variants": true,
                    "units": [
                        {
                            "type": "include",
                            "words": ["terrorists", "terrorist", "kill", "killing"]
                        },
                    ]

                }
            ]);
        }
    })
  
</script>
</html>